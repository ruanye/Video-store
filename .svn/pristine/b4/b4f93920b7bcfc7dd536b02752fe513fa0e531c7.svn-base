//url请求参数
var REQUEST = (function GetRequest() {
	var url = location.search;
	var theRequest = new Object();
	if (url.indexOf("?") != -1) {
		var str = url.substr(1);
		strs = str.split("&");
		for(var i = 0; i < strs.length; i ++) {
			theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
		}
	}
	return theRequest;
})();
Config = {
  hostUrl:""
}

//调试时直接显示page
if( REQUEST.page ){
  togglePage(REQUEST.page);
}
//调试时直接显示提示框遮罩
if( REQUEST.mask ){
  toggleMask(REQUEST.mask);
}
//切换页
function togglePage( pageIndex ){
  $(".page").removeClass("active");
	$(".mask").removeClass("active");
  $(".page"+pageIndex).addClass("active");
}
//切换遮罩
function toggleMask( maskIndex ){
  $(".mask").removeClass("active");
  $(".mask"+maskIndex).addClass("active");
}


//活动详情
$(".page1 .link span").on('click',function(){
	window.location.href = "http://baidu.com";
});
//下载app
$(".page2 button").on('click',function(){
	window.location.href = "http://t.cn/RA9l7SD";
});
$(".page1 button").on("click",function(){
	var phone = $(".page1 input").val();
	if(!/^\d{11}$/.test(phone)){
    alert('手机号格式错误');
    return;
  }
	var text = $(this).html();
	$(this).html("领取中...");
	$.post('/onecoupon/save/'+REQUEST.id+'-'+phone,function(data){
    $('.page1 .btn.get').html(text);
    if( data.status != 1){
      alert(data.messsage);
      return;
    }
		togglePage("2");
		window.localStorage.setItem('phone',phone);
    if(data.robstatus != 1){
      $(".page2 .tips").hide();
    }else{
			$(".page2 .tips2").hide();
		}
    //console.log(data);
  });
});
