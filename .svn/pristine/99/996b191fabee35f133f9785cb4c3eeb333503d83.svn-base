$(function() {
    var $height = $(document).height()
    if (GetRequest()['orginName'] != undefined) {
        $('#page8').find('.content .p2').html("和 " + decodeURIComponent(GetRequest()['orginName']) + " 一起坐")
        $('#page8').show()
    } else {
        $('#page1').show()
    }
    $('#page8').on('click',function(){
        $('#page8').hide()
        $('#page2').show()
       
    })
    $('#page3').height($height)
    $('#shagnma').on('click', function(e) {
        $('#page1').hide()
        $('#page2').show()
    })
    $('#page2 .newUer').on('click', function(e) {
        window.location.href = 'https://get.uber.com.cn/invite/GZH5003';
    })
    $('#page2 .oldUer').on('click', function(e) {
        $('#page2').hide()
        $('#page3').show()
    })
    $('#save_btn').on('click', function(e) {
        Coupon.save()
    })
    $('#page4 .people-icon').on('click', function(e) {
        $('#page4').hide()
        $('#page5').show()
    })
    $('#get').on('click', function() {
        $('#page5 .dialog').show()
    })
    $('#page5 .dialog ul').on('click', 'li', function(e) {
        $('#page5 .dialog').hide()
        orginName = $(this).text()
        $('#page5 #get').val(orginName)
    })
    $('#page5 .zhuanshu').on('click', function(e) {
        if ($('#page5 #get').val() == '') {
            $("#biaoqian").html("<font color='#000'>请选择专属标签</font>");
            return false
        }
        window.history.pushState(null, null, "index.html?" + "id=" + GetRequest()['id'] + "&sourceId=" + Coupon.data.sourceId + "&orginName=" + orginName);
        $('#page5').hide()
        $('#page6').show()
    })
    $('#page6 .p6').on('click', function(e) {
        $('#page6').hide()
        $('#page7').show()
    })
    var Coupon = {
        actId: null,
        data:'',
        //保存
        save: function(toflag, money) {
            var _this=this;
            var phoneNumber = $("#phoneNumber").val();
            if (phoneNumber.length == 0) {
                $("#errorInfo").html("<font color='#000'>请填写手机号码</font>");
                return;
            }
            if (phoneNumber.length != 11) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
            if (!reg.test(phoneNumber)) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            $('#save_btn').attr('disabled', 'disabled').html('获得中...');
            $.post("/refer/fetch", {
                phone: phoneNumber,
                sourceId: GetRequest()['sourceId'],
                activityId: Coupon.actId
            }, function(data) {
                console.log(data);
                _this.data = data;
                if (data.code==0) {
                    $('#page3').hide()
                    $("#page4").show();
                    return 
                }
                if (data.code != 0) {
                    alert(data.message);
                    return;

                }
            });
        }
    }

    $(document).ready(function() {
        var request = GetRequest();
        Coupon.actId = request['id'];
        if (Coupon.actId) {
            Event.sendEvent("counpon_" + Coupon.actId);
        } else {

            //结束界面
            // $("#page1").hide();
            // $("#page11").show();
        }
    });
})



