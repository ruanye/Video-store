$('.label-switch input[type=checkbox]').live('change',function (e) {

    e.preventDefault();
if($('#recivebox').is(':checked')){
    $('#recive-man').hide();
    $("#reciveName").val("");
    $("#reciveID").val("");
}
else{$('#recive-man').show();}

if($('#sendbox').is(':checked')){
    $('#send-man').hide();
    $("#sendName").val("");
    $("#sendID").val("");
}
else{$('#send-man').show();}

});


var ECT = {
    init:function() {

        //显示数据
        var user = LS.getObj("user");
        $("#carNumberDiv").html(user.lpn);
        $("#carNameDiv").html(user.ownerName);
        $("#brandInput").val(user.brand == undefined ? "" : user.brand);
        $("#engineNoInput").val(user.engineNo == undefined ? "" : user.engineNo);
        $("#firstTimeInput").val(user.firstTime == undefined ? "" : user.firstTime);

        //身份证号码
        if (user.ownID != undefined && user.ownID != null) {
            var ownid = user.ownID;
            $("#ownIDInput").val(ownid);
            var showOwnid = ownid.substr(0, 3);
            for (var i = 0; i < ownid.length-7; i++) {
                showOwnid += "*";
            }
            showOwnid += ownid.substr(ownid.length-4, ownid.length);
            $("#ownIDInput1").val(showOwnid);
            $("#ownIDInput1").attr("disabled", true);
        }else {
            $("#ownIDInput1").removeAttr("disabled");
            $("#ownIDInput1").val("");
            $("#ownIDInput").val("");
        }

        //电话号码
        if (user.ownerNumber != undefined && user.ownerNumber != null) {
            var ownerNum = user.ownerNumber;
            $("#ownerNumberInput").val(ownerNum);
            var showOwnNum = ownerNum.substr(0, 3);
            for (var i = 0; i < ownerNum.length-7; i++) {
                showOwnNum += "*";
            }
            showOwnNum += ownerNum.substr(ownerNum.length-4, ownerNum.length);
            $("#ownerNumberInput1").val(showOwnNum);
            $("#ownerNumberInput").val(ownerNum);
            $("#ownerNumberInput1").attr("disabled", true);
        }else {
            $("#ownerNumberInput1").removeAttr("disabled");
            $("#ownerNumberInput1").val("");
            $("#ownerNumberInput").val("");
        }

        $("#vinInput").val(user.vin == undefined ? "" : user.vin);

        //是否过户
        var portals = document.getElementsByName("opinions");
        for(var i = 0; i < portals.length; i++) {
            if(portals[i].value == user.transfer) {
                portals[i].checked="checked";
            }
        }
        if (user.transfer == "" || user.transfer == null) {
            portals[1].checked = "checked";
        }

        //如果是新车未上牌,则隐藏车牌号码
        var isSelect = LS.get("isSelected");
        if (isSelect == 1) {
            $("#carNumberLi").hide();
        }

        //点击确认录入
        $(document).on('click', '.col-100', function () {
            //判断投保以及被保人
            var reciveName = $("#reciveName").val();
            var reciveID = $("#reciveID").val();
            var sendName = $("#sendName").val();
            var sendID = $("#sendID").val();
            if(!$('#recivebox').is(':checked')){
                if (reciveName == null || reciveName == "") {
                    $.alert("请输入被保人姓名");
                    return;
                }
                if (reciveID == null || reciveID == "") {
                    $.alert("请输入被保人的身份证号码");
                    return;
                }
            }
            if(!$('#sendbox').is(':checked')){
                if (sendName == null || sendName == "") {
                    $.alert("请输入投保人姓名");
                    return;
                }
                if (sendID == null || sendID == "") {
                    $.alert("请输入投保人的身份证号码");
                    return;
                }
            }


            $.showPreloader('保存中....');

            var jsonStr = {
                "brand": $("#brandInput").val(),
                "engineNo": $("#engineNoInput").val(),
                "firstTime": $("#firstTimeInput").val(),
                "id": user.id,
                "lpn": user.lpn,
                "ownID": $("#ownIDInput").val(),
                "ownerName": user.ownerName,
                "ownerNumber": $("#ownerNumberInput").val(),
                "transfer": $("input[name='opinions']:checked").val(),
                "userId": user.userId,
                "vin": $("#vinInput").val(),
                "recognizeeName": reciveName,
                "recognizeeNumber": reciveID,
                "applicantName": sendName,
                "applicantNumber": sendID
            }
            $.ajax({
                url: Constants.hostIp+'weixin/lpn/saveVehicle',
                type: 'post',
                // timeout: 5000,
                dataType:'json',
                data: jsonStr,
                success: function(data, status) {
                    $.hidePreloader();
                    if (status == 'success' && data.status == 0) {
                        $.toast("录入成功");
                        if (isSelect == 1) {
                            $.alert(user.ownerName+"您好,由于您的爱车是新车,帮小妹需要亲自为您服务,请保持电话畅通哦^_^", function () {
                                window.location.href = 'index.html';
                            })

                        }else {
                            sessionStorage.currentCar = LS.getObj("user").lpn;
                            window.location.href = 'select-set.html?suit=' + sessionStorage.suitIndex;
                        }
                    }else {
                        $.alert(data.msg);
                        return;
                    }
                },
                error: function(err) {
                    $.hidePreloader();
                    console.log(err);
                    $.toast("保存失败");
                }
            })
        });
    }
}

ECT.init();
$.init();

function checkNumberAndLetterInput(m_this, info, type) {
    if ($(m_this).val() == "") {
        return;
    }
    if (type == 1) {
        var reg = /^[0-9a-zA-Z ]+$/;
        if ( !reg.test($(m_this).val()) ) {
            $.toast(info + "只能输入数字和字母");
            $(m_this).val("");
            return;
        }
    } else {
        var reg = /^[0-9a-zA-Z]+$/;
        if ( !reg.test($(m_this).val()) ) {
            $.toast(info + "只能输入数字和字母");
            $(m_this).val("");
            return;
        }
        $(m_this).val($(m_this).val().toUpperCase());
    }

}

//验证品牌型号
function checkBrand(m_this, info) {
    if ($(m_this).val() == "") {
        return;
    }
    if (/[\u4E00-\u9FA5]/i.test($(m_this).val())) {
        $.toast(info + "不能包含中文");
        $(m_this).val("");
        return;
    }
}

function checkCellPhoneInput(m_this) {
    if ($(m_this).val() == "") {
        return;
    }
    var reg = /^1[34578][0-9]\d{8}$/;
    if ( !reg.test($(m_this).val()) ) {
        $.toast("请输入正确的手机号码");
        $(m_this).val("");
        return;
    }
    $(m_this).val($(m_this).val().toUpperCase());
    $("#ownerNumberInput").val($(m_this).val().toUpperCase());
}

function checkIdentifyInput(m_this) {
    if ($(m_this).val() == "") {
        return;
    }
    var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
    if (!reg.test($(m_this).val())) {
        $.toast("请输入正确身份证号");
        $(m_this).val("");
        return;
    }
    $(m_this).val($(m_this).val().toUpperCase());
    $("#ownIDInput").val($(m_this).val().toUpperCase());
}

function hideAll() {
    $(".screen_mask").hide();
    $(".maskcontent").hide();
}

function showInfo(type) {
    $(".screen_mask").show();
    $(".maskcontent").show();


    var isSelect = LS.get("isSelected");
    if (isSelect == 1) {
        //未上牌
        if (type == "brandType") {
            $(".maskcontent").attr("src", "images/ex1.png");
        } else if (type == "vin") {
            $(".maskcontent").attr("src", "images/ex2.png");
        } else if (type == "engineNo") {
            $(".maskcontent").attr("src", "images/ex3.png");
        } else {
            hideAll();
        }
    }else {
        if (type == "brandType") {
            $(".maskcontent").attr("src", "images/example1.png");
        } else if (type == "vin") {
            $(".maskcontent").attr("src", "images/example2.png");
        } else if (type == "engineNo") {
            $(".maskcontent").attr("src", "images/example3.png");
        } else {
            hideAll();
        }
    }

}