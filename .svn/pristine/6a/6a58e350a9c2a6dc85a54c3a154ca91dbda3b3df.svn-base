
$('#page1 .button').on('click',function(e){
    $('#page1').hide()
    $('#page2').show()
    Event.sendEvent("counpon_" + Coupon.actId + 'phone');
})
$('#page2 .button').on('click',function(e){
    Coupon.save()
})
$('#page4 .button').on('click',function(e){
    window.location.href="https://get.uber.com.cn/invite/面茶来了"
})
$('#page5 .button').on('click',function(e){
    $('#page5').hide()
    $('#page6').show()
})

var Coupon = {
    actId: null,
    //保存
    save: function() {

        var phoneNumber = $("#phoneNumber").val();
        if (phoneNumber.length == 0) {
            $("#errorInfo").html("<font color='red'>请填写手机号码</font>");
            return;
        }
        if (phoneNumber.length != 11) {
            $("#errorInfo").html("<font color='red'>请填写有效的手机号码</font>");
            return;
        }
        var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
        if (!reg.test(phoneNumber)) {
            $("#errorInfo").html("<font color='red'>请填写有效的手机号码</font>");
            return;
        }
        $('.btn').attr('disabled', 'disabled').html('获得中...');
        $.post('http://coupontj.leanapp.cn/onecoupon/save/' + Coupon.actId + "-" + phoneNumber,function(data) {
            console.log(data);
            Event.sendEvent("counpon_" + Coupon.actId + 'result');
            if (data.status===-1||data.robstatus===2) {
                //活动结束页面
                $('#page2').hide();
                $("#page3").show();
                return 
            }
            if(data.isrob==1){
                alert('您已经参加过抢券')
                return
            }
            if(data.robstatus===0){
                $('#page2').hide()
                $('#page5').show()
                return
            }            
            if(data.robstatus===1){
                $('#page2').hide()
                $('#page4').show()
            }
        });
    }
}
$(document).ready(function() {
    var request = GetRequest();
    Coupon.actId = request['id'];
    if (Coupon.actId) {
        Event.sendEvent("counpon_" + Coupon.actId);
    } else {
        //结束界面
        $("#page1").hide();
        $(".end").show();
    }
});
