function fetchCarCoupon(){AV.Cloud.run("mobile_activity_getCoupon",{activityId:activityId},{success:function(o){$("#carCouponId").val(o[0].objectId)},error:function(o){$("#page5").hide(),$("#page3").show()}})}function phoneCoupon(){var o=$("#phoneNumber").val();if(0==o.length)return void $("#errorInfo").html("<font color='red'>请填写手机号码</font>");if(11!=o.length)return void $("#errorInfo").html("<font color='red'>请填写有效的手机号码</font>");var t=/^0?1[3|4|5|7|8][0-9]\d{8}$/;if(!t.test(o))return void $("#errorInfo").html("<font color='red'>请填写有效的手机号码</font>");$("#phone_btn").attr("disabled","disabled"),$("#phone_btn").html("<div>获取中...</div>");var e=$("#carCouponId").val();AV.Cloud.run("mobile_carcoupon_saveCoupon",{carCouponId:e,phoneNumber:o,activityId:activityId},{success:function(t){1==t.state?syncDataToUber(o):2==t.state&&($("#page4").hide(),$("#page3").show())},error:function(){$("#phone_btn").removeAttr("disabled"),$("#phone_btn").html("<div>确定</div>"),$("#page4").hide(),$("#page1").show()}})}function syncDataToUber(o){$("#convert_btn").html("<div>领取中...</div>");var t={phone:o,type:"onecoupon",activityId:$("#carCouponId").val()};AV.Cloud.run("mobile_uber_sync",t,{success:function(o){$("#page4").hide(),-1==o.status?($("#page1").show(),$("#convert_btn").html("<div>领取失败</div>")):1==o.status||3==o.status?$("#page3").show():$("#page6").show()},error:function(o){$("#page4").hide(),$("#page1").show(),console.log(JSON.stringify(o)),$("#convert_btn").html("<div>领取失败</div>")}})}var request=GetRequest(),activityId=request.id;$(document).ready(function(){Event.sendEvent("counpon_"+activityId),AV.Cloud.run("mobile_activity_isFetch",{activityId:activityId},{success:function(o){1==o.validate?fetchCarCoupon():($("#page5").hide(),$("#page1").show())},error:function(o){console.log(JSON.stringify(o)),$("#page5").hide(),$("#page1").show()}})});