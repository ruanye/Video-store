/**
 * 加载优惠券
 * @zxyuns
 * 2016-06-23
 * userId=6;
 * isUsed	是否使用
 * serverScope	是否过期表示，1是过期
 */
var userId=localStorage.getItem(Constants.userid);


$(function(){
    loadCoupon();//过期
    $.init();
});

/**
 * 加载用户的基本信息
 */
function loadCoupon(){
    var notData = {
        pageNo:1,
        pageSize:9999,
        userId:userId//用户ID
    };
    $.ajax({
        url:Constants.hostIp+"weixin/user/coupon/list",
        type: "get",
        data:notData,
        success:function(data, status, xhr){
            if(data.status==0){
                var list=data.map.list;
                $("#couponData").html("");
                var strHtml="";
                for(var i=0;i<list.length;i++){
                    var obj=list[i];
                    //str.substr(0, 1)
                    var myTime=obj.startDateString.substr(0,10)+"~"+obj.endDateString.substr(0,10);
                    strHtml +='<div class="row padding_20">';
                    strHtml +='<div class="col-40">';
                    strHtml +='<div class="item-media">';
                    strHtml +='<span class="icon-uniE600 num_font" >'+obj.discount+'</span>';
                    strHtml +='</div></div>';
                    strHtml +='<div class="col-60">';
                    strHtml +='<div class="item-inner">';
                    strHtml +='<div class="item-title-row">';
                    strHtml +='<div class="item-title">'+obj.couponName+'</div>';
                    strHtml +='</div>';

                     if(obj.isUsed==0 && obj.serverScope=="0"){//未使用 未过期
                         strHtml +='<div class="item-subtitle small-font bottomline">'+myTime+'</div>';
                         strHtml +='<div class="item-subtitle small-font">劵编码：'+obj.ccode+'</div>';
                     }else if(obj.isUsed==1){//已经使用过的
                         strHtml +='<div class="item-subtitle small-font bottomline2">'+myTime+'</div>';
                         strHtml +='<div class="item-subtitle small-font">劵编码：'+obj.ccode+'</div>';
                         strHtml +='<div class="item-media position_right">';
                         strHtml +='<span class="icon-uniE60A" style="font-size: 50px;color: #a6ce38;"></span>';
                         strHtml +='</div>';
                     }else if(obj.serverScope=="1"){//已经过期的
                         strHtml +='<div class="item-subtitle small-font bottomline2">'+myTime+'</div>';
                         strHtml +='<div class="item-subtitle small-font">劵编码：'+obj.ccode+'</div>';
                         strHtml +='<div class="item-media position_right">';
                         strHtml +='<span class="icon-uniE609" style="font-size: 54px;color: #a6ce38;"></span>';
                         strHtml +='</div>';
                     }
                    strHtml +='</div></div></div>';

                }
                $("#couponData").html(strHtml);
            }else{
                alert(data.msg);
            }
        }
    });
}


