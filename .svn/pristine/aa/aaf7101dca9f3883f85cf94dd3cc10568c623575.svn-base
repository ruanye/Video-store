$(function() {
    var answer = [2, 3, 3, 3, 2, 4] //模拟成绩
    var correctNumber = 0;
    var number = 0;
    $('#start-button').on('click', function(e) {
        $('#page1').hide()
        $('#page2').show()
    })
    $('#page2 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        number++;
        setTimeout(function() {
            $('#page2').hide()
            $('#page3').show()
        }, 1000);
    })
    $('#page3 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        number++;
        setTimeout(function() {
            $('#page3').hide()
            $('#page4').show()
        }, 1000);
    })
    $('#page4 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        number++;
        setTimeout(function() {
            $('#page4').hide()
            $('#page5').show()
        }, 1000);
    })
    $('#page5 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        number++;
        setTimeout(function() {
            $('#page5').hide()
            $('#page6').show()
        }, 1000);
    })
    $('#page6 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        number++;
        setTimeout(function() {
            $('#page6').hide()
            $('#page7').show()
        }, 1000);
    })
    $('#page7 .select-content').one('click', '.select-item', function(e) {
        var $index = $(this).index()
        $(this).addClass('active')
        if ($index == answer[number]) {
            correctNumber++;
            console.log(correctNumber);
        }
        if (correctNumber >= 0 && correctNumber <= 2) {
            $('#page8').find('.trigon .p3').text('不中神')
        }
        if (correctNumber >= 3 && correctNumber <= 4) {
            $('#page8').find('.trigon .p3').text('有板眼')
        }
        if (correctNumber >= 5) {
            $('#page8').find('.trigon .p3').text('蛮扎实')
        }
        setTimeout(function() {
            $('#page7').hide()
            $('#page8').show()
        }, 1000);
    })
    $('#save_btn').on('click', function(e) {
        Coupon.save()
    })
    var Coupon = {
        actId: null,

        //保存
        save: function(toflag, money) {
            var phoneNumber = $("#phoneNumber").val();
            if (phoneNumber.length == 0) {
                $("#errorInfo").html("<font color='#000'>请填写手机号码</font>");
                return;
            }
            if (phoneNumber.length != 11) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
            if (!reg.test(phoneNumber)) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            $('#save_btn').attr('disabled', 'disabled').html('获得中...');
            $.post('/onecoupon/save/' + Coupon.actId + "-" + phoneNumber, {}, function(data) {
                console.log(data);
                if (data.status == -1 || data.robstatus == 2) {
                    //活动结束页面
                    $('#page8').hide()
                    $("#page11").show();
                } else {
                    //成功页面
                    if (data.robstatus == 1) {
                        //新用户抢码成功
                        $('#page8').hide()
                        $('#page10').show()
                        $('#register').on('click',function(e){
                            window.location.href = 'https://get.uber.com.cn/invite/GZH5003';
                        })
                        setTimeout(function(){
                            window.location.href = 'https://get.uber.com.cn/invite/GZH5003';
                        },3000);
                    }
                    if (data.robstatus == 0) {
                        //老用户抢码成功
                        $('#page8').hide()
                        $("#page9").show();
                    }
                }
            });
        }
    }

    $(document).ready(function() {
        var request = GetRequest();
        Coupon.actId = request['id'];
        if (Coupon.actId) {
            Event.sendEvent("counpon_" + Coupon.actId);
        } else {
            //结束界面
            $("#page1").hide();
            $("#page11").show();
        }
    });
})
