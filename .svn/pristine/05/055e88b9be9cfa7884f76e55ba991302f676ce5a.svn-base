$(function() {
    $('#page1 .getBtn').on('click',function(e){
        $('#page1').hide()
        $('#page2').show()
    })
    $('#page2 .getPrice').on('click',function(e){
        Coupon.save()
    })
    $('#page3 .discount .left').on('click',function(e){
        $(this).find('.text').text('领取成功')
    })      
    $('#page3 .discount .right').on('click',function(e){
        $('#page3').hide()
        $('#page4').show()
    })
    $('#page4 .discount .left').on('click',function(e){
        $(this).find('.text').text('领取成功')
    })    
    var Coupon = {
        actId: null,
        data: '',
        //保存
        save: function(toflag, money) {
            var _this = this;
            var phoneNumber = $("#phoneNumber").val();
            if (phoneNumber.length == 0) {
                $("#errorInfo").html("<font color='#000'>请填写手机号码</font>");
                return;
            }
            if (phoneNumber.length != 11) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
            if (!reg.test(phoneNumber)) {
                $("#errorInfo").html("<font color='#000'>请填写有效的手机号码</font>");
                return;
            }
            $('#save_btn').attr('disabled', 'disabled').html('获得中...');
            $.post('http://couponhz.leanapp.cn/morecoupon/save/' + Coupon.actId + "-" + phoneNumber, {
                israndom:1
            }, function(data) {
                console.log(data);
                if (data.robstatus == 1) {
                    location.href = "https://get.uber.com.cn/invite/武林大会奖金池1"
                }
                if (data.robstatus == 0) {
                    $('#page3 .money').text(data.money)
                    $("#page2").hide();
                    $("#page3").show();
                }
            });
        }
    }

    $(document).ready(function() {
        var request = GetRequest();
        Coupon.actId = request['id'];
        if (Coupon.actId) {
            Event.sendEvent("counpon_" + Coupon.actId);
        } else {
            //结束界面
            // $("#page1").hide();
            // $("#page11").show();
        }
    });
})
