var Index = {
    init: function() {
        //console.log($.device);//检测设备信息
        //localStorage.userId = 9;
        $.init();
        Index.loadData();
        this.recomand()
        /*
        $(document).on('click', '.item', function () {
            var buttons1 = [
                {
                    text: '请选择',
                    label: true
                },
                {
                    text: '没有爱车信息',
                    bold: false,
                    color: 'danger',
                    onClick: function () {
                        // ignoreCache 是加载一个新页面时是否忽略缓存而发网络请求，默认是 false，表示使用缓存，可以设为 true 来忽略缓存
                        //$.router.load('entry-car.html', false);
                        //A页面跳转B页面不采用  路由功能
                        window.location.href = 'entry-car.html';
                    }
                },
                {
                    text: '已有爱车信息',
                    onClick: function () {
                        $.alert("你选择了“已有爱车信息“");
                        //$.toast('操作成功，正在跳转...', 2345, 'success top');
                    }
                }
            ];
            var buttons2 = [
                {
                    text: '取消',
                    bg: 'danger'
                }
            ];
            var groups = [buttons1, buttons2];
            $.actions(groups);
        });
       */
    },
    loadData: function() {
        $.get(Constants.hostIp+'weixin/insuranceSuit/list', null, function(data) {
            var lst = data.list;
            var ulHtml = "";
            for (var i = 0; i < lst.length; i++) {
                ulHtml += '<li class="item" onclick="selectSuit(this, ' + i + ')"><div class="item-top"><div class="item-title">' + lst[i].suitName + '</div></div>';
                ulHtml += '<div class="item-body">' + lst[i].detail + '</div></li>';
            }
            $("#list-ul").html(ulHtml);
        });
    },
    recomand:function(){
        var _this=this;
        wx.ready(function(){
            wx.onMenuShareAppMessage({
                title:shareObject.title , // 分享标题
                desc: '', // 分享描述
                link: shareObject.link+"?selfInviteCode="+sessionStorage.selfInviteCode, // 分享链接
                imgUrl: shareObject.icon, // 分享图标
                type: 'link', // 分享类型,music、video或link，不填默认为link
                success: function (data) {

                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });   
            wx.onMenuShareTimeline({
                title: shareObject.title, // 分享标题
                link: shareObject.link+"?selfInviteCode="+sessionStorage.selfInviteCode, // 分享链接
                imgUrl: shareObject.icon, // 分享图标
                success: function () {

                },
                cancel: function () {

                }
            });         
        })
        if(_this.GetRequest()['selfInviteCode']!==undefined){
            var ajaxData={
                otherInviteCode:_this.GetRequest()['selfInviteCode'],
                openid:LS.get(Constants.openid)
            }
            $.ajax({
                type:'post',
                url:Constants.hostIp+'/weixin/user/recommend',
                data:ajaxData,
                success:function(data,status){
                    if(data.status==0){
                        // $.alert('推荐成功')
                    }else{
                        // $.alert(data.msg)
                    }
                }            
            })
        }
    },
    GetRequest:function() {
        var url = location.search;
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
}
Index.init();

function selectSuit(item, n) {
    sessionStorage.suitIndex = n;
    var userId = localStorage.userId || 0;
    $.get(Constants.hostIp+'weixin/trade/listVehicle?user=' + userId, null, function(data) {
        if (data.list && data.list.length) {
            window.location.href = 'select-set.html?suit=' + n;
        } else {
            window.location.href = 'entry-car.html';
        }
    });
}
