function Book(t,e,i,n){this.speed=i,this.x=t,this.y=e,this.width=$width*(n.width/640),this.height=$width*(n.height/640),this.img=n,this.value=n.value}function Hero(t,e,i){this.grade=0,this.life=1,this.x=t,this.y=e,this.img=i,this.width=$width*(i.width/640),this.height=$width*(i.height/640)}function initGame(){console.log("initGame");var t=document.createElement("canvas");t.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t.height=window.innerHeight-80||document.documentElement.clientHeight-80||document.body.clientHeight-80,t.id="canvas",document.getElementById("page3").appendChild(t);var e=document.createElement("div"),i='<div class="foot-bar"></div>';e.innerHTML=i,e.className="newDiv",document.getElementById("page3").appendChild(e);var n=document.createElement("div"),h='<div id="last-time"></div><div class="right-round"><p>已接收<br><span id="book_num">00</span>本</p></div>';n.innerHTML=h,n.className="newDiv",document.getElementById("page3").appendChild(n);var a=t.getContext("2d");return a.drawImage(bg,0,t.height-bg.height,t.width,bg.height),a.drawImage(heroImg,(t.width-heroImg.width)/2,t.height-heroImg.height),"start"!=localStorage.getItem("startGame")?void(document.getElementById("initHint").style.display="none"):(localStorage.setItem("startGame","end"),void(document.getElementById("initHint").style.display="none"))}function drawBuffer(t,e,i,n){t.clearRect(0,0,e.width,e.height),t.drawImage(n,0,0)}for(var surplusSecond=0,targetMsg="Uber",tempMsg="",num=0,msgindex=0,$width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,$height=window.innerHeight-80||document.documentElement.clientHeight-80||document.body.clientHeight-80,logos=new Array,i=0;2>i;i++){logos[i]=new Image;var index="";switch(index=i,logos[i].src="images/jie-game/shu/book"+index+".png",logos[i].className="book1",logos[i].speed=10,i){case 0:logos[i].value=i;break;case 1:logos[i].value=i;break;default:logos[i].value=0}}var heroImg=new Image;heroImg.src="images/jie-game/car.png";var bg=new Image;bg.src="images/jie-game/bg1.png",Book.prototype={draw:function(t){t.drawImage(this.img,this.x,this.y,this.width,this.height)},move:function(){this.y+=this.speed}};var idx=0;Hero.prototype={draw:function(t){t.drawImage(heroImg,this.x,this.y,this.width,this.height)},touch:function(t){var e=t.y+t.height;return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height/5>t.y&&this.y<e?(this.grade++,!0):!1}};var App={elements:[],backImg:bg,imgs:logos,hero:null,canvas:null,context:null,frontCanvas:null,frontContext:null,timer:null,speed:0,pause:!1,draw:function(){this.context.clearRect(0,0,this.canvas.width,canvas.height),this.context.drawImage(this.backImg,0,canvas.height-this.backImg.height,this.canvas.width,this.backImg.height),this.hero.draw(this.context);for(var t=0;t<this.elements.length;t++){var e=this.elements[t];e.x>this.canvas.width||e.x<0||e.y>this.canvas.height||e.y<0?this.elements.splice(t,1):this.hero.touch(e)?(this.elements.splice(t,1),document.getElementById("book_num").innerHTML=this.hero.grade):e.draw(this.context)}drawBuffer(this.frontContext,this.frontCanvas,this.context,this.canvas)},loop:function(){var t=App;if(!t.pause){for(var e=0;e<t.elements.length;e++)t.elements[e].move();var i=9e3*Math.random();if(400>i){var n={};if(num%4==0){t.imgs.length-1==num/4&&(num=0),n=t.imgs[msgindex],console.log("imgs",n.src);var h=Math.random()*(t.canvas.width-t.imgs[parseInt(i%t.imgs.length)].width),a=0,s=n.speed,o=new Book(h,a,s,n);t.addElement(o)}n=t.imgs[parseInt(i%t.imgs.length)];var h=Math.random()*(t.canvas.width-t.imgs[parseInt(i%t.imgs.length)].width),a=0,s=n.speed,o=new Book(h,a,s,n);t.addElement(o),num++}t.draw()}},gameStart:function(t,e){function i(t){var e=t.changedTouches[0],i=e.clientX-n.frontCanvas.offsetLeft-n.hero.width/2;i>0&&i<n.frontCanvas.width-n.hero.width&&(n.hero.x=i),t.preventDefault()}console.log("gameStart");var n=this;n.frontCanvas=document.getElementById(t),n.frontContext=n.frontCanvas.getContext("2d"),n.canvas=document.createElement("canvas"),n.canvas.width=n.frontCanvas.width,n.canvas.height=n.frontCanvas.height,n.context=n.canvas.getContext("2d"),n.speed=e,console.log("heroImg",heroImg),n.hero=new Hero((n.canvas.width-heroImg.width)/2,n.canvas.height-$width*(heroImg.height/640),heroImg),n.frontCanvas.addEventListener("touchmove",i),n.timer=setInterval(n.loop,10*n.speed),surplusSecond=10,window.clearInterval(interval),interval=setInterval(function(){surplusSecond--;var t="剩余"+surplusSecond+"秒";$("#last-time").html(t),0>=surplusSecond&&(clearInterval(interval),App.gameOver())},1e3)},gamePause:function(){this.pause=!0,this.context.textAlign="center",this.context.fillStyle="#f00",this.context.font="bold 40px Arial",this.context.fillText("暂停",this.canvas.width/2,this.canvas.height/2),this.context.font="bold 20px/1.5 Arial",this.context.fillText("点击屏幕继续",this.canvas.width/2,this.canvas.height/2+40)},gameOver:function(){console.log("gameOver"),clearInterval(this.timer),console.log(this.hero.grade),this.elements=[],this.pause=!1,this.timer=null,this.context.textAlign="center",this.context.fillStyle="#f00",this.context.font="bold 20px/1.5 Arial",0==this.hero.grade?this.context.fillText("真可惜,再试一次吧...",this.canvas.width/2,this.canvas.height/2):this.context.fillText("游戏结束，恭喜您接到"+this.hero.grade+"本图书",this.canvas.width/2,this.canvas.height/2);var t=-1;t=this.hero.grade<1e3?3:this.hero.grade<1500?2:3,drawBuffer(this.frontContext,this.frontCanvas,this.context,this.canvas),setTimeout(function(){localStorage.setItem("score",App.hero.grade),$("#page3").hide(),$("#page4").show(),getGameScore()},2e3)},addElement:function(t){this.elements.push(t)}},interval=0;window.onload=function(){setTimeout("initGame()",100)};