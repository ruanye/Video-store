var mask_details_tmpl = "服务器错误!!";
$(function(){
    $("head").append('<link rel="stylesheet" type="text/css" href="css/mask-details.css">');
    $.get("mask-details.html",function( text ){
        mask_details_tmpl = text;
    });
});

function details( id,scoreType ){
    window.scoreType = scoreType;
    $.get(Constant.WEB_ROOT+"/manager/teacher/student/students",{
        studentId:id,
    },function( data ){
        console.log(data.student);
        var result = tmpl(mask_details_tmpl,{
            data:data.student,
        });

        $("[class^=mask]").hide();
        $(".mask-details > .details").html( result );
        $(".mask-details").show();
    });

}

//设置菜单展开逻辑
function showExtMenu( menuid ){
    var $extMenu = $("[data-menuid='"+menuid+"']");
    clearTimeout($("body").data("timeout"+menuid));
    $(".content > .menu > .items > .item").eq(menuid-1).addClass("active");
    $extMenu.show();
}
function hideExtMenu( menuid ){
    var $extMenu = $("[data-menuid='"+menuid+"']");
    $("body").data("timeout"+menuid,setTimeout(function(){
        $(".content > .menu > .items > .item").eq(menuid-1).removeClass("active");
        $extMenu.hide();
    },300));
}

//设置星星打分菜单
function showStars( index ){
    var $stars = $(".extmenu > .right");;
    $stars.find(".stars").removeClass("active");
    $stars.find(".stars:lt("+index+")").addClass("active");
}
function hideStars(){
    var $stars = $(".extmenu > .right");
    $stars.find(".stars").removeClass("active");
}


//考勤
function kaoqin( type ){
    if(typeof(CI) == 'undefined'){
        $.alert({
            title:"考勤提示",
            contentText:"请在签到处进行签到操作...",
            callback:function( event ){}
        });
        return;
    }
    var typeString = ["出勤","迟到","早退","请假","旷课","替签",];
    var studentId = $(".details .menu").data("id");
    $.get(Constant.WEB_ROOT+"/manager/teacher/signWithTeacher",{
        status:type,
        studentId:studentId,
        ttSerialId:SS.get(Constant.timeTableSerialId),//流水
    },function( data ){
        if(data.status == 0){
            $.alert({
                title:"考勤提示",
                contentText:typeString[type-1]+"成功",
                cancleText:"确定",
                callback:function( event ){
                    var isCheck = SS.get(Constant.isCheck) == null ? 0 : SS.get(Constant.isCheck);//课堂签到状态
                    $("[class^=mask]").hide();
                    if(isCheck != 0){
                        CI.autoCheckInData(studentId);//更新签到数据
                    }
                }
            });
        }else{
            $.alert({
                title:"考勤提示",
                contentText:"考勤失败，请稍后重试...",
                callback:function( event ){}
            });
        }
    });
}
//打分
function stars( type ){
    var studentId = $(".details .menu").data("id");
    $.post(Constant.WEB_ROOT+"/manager/teacher/score/single",{
        scoreType:scoreType, //二次提问
        starNum:type,
        studentId:studentId,
        ttSerialId:SS.get(Constant.timeTableSerialId),//流水
    },function( data ){
        if(data.status == 0){
            $.alert({
                title:"评分提示",
                contentText:"评分成功，本次给出的评分为："+type+"星",
                cancleText:"确定",
                callback:function( event ){}
            });
        }else{
            $.alert({
                title:"打分提示",
                contentText:"评分失败，请稍后重试...",
                callback:function( event ){
                }
            });
        }
    });
}
