var preprice = {
    init: function () {
        //console.log($.device);//检测设备信息
        // $.init();
        $("#more-btn").click(function () {
            $("#more-company").toggle();
            if ($("#more-btn").text() == "更多公司>"){
                $("#more-btn").text("更多公司v");
                var $top=$(this).offset().top+20
                document.querySelector('.native-scroll').scrollTop=$top;
            }
            else{
                $("#more-btn").text("更多公司>");
                document.querySelector('.native-scroll').scrollTop=0;
            }

        })

        //点击选择保险公司按钮
        $("#selectedCompany").val(0)
        $("#select-btn").click(function () {
            var cid = $("#selectedCompany").val();
            if(cid==0)
                $.alert("亲,您还没有选好保险公司呢");
            else {
                SS.set("selectedCompanyId", cid);
                window.location.href = "policyYes.html";
            }
        });

        $('.lst-radio').live('change', function (e) {
            e.preventDefault();
            if ($(this).is(':checked')) {
                $('.company-info').hide();
                $(this).parent().parent().next('.company-info').show();
                $("#total_fee").text( "总保费:￥" + ($(this).attr("data-price")/100).toFixed(2));
                $("#selectedCompany").val($(this).attr("data-companyId"));
                var company = {};
                company.id = $(this).attr("data-companyId");
                company.icon = $(this).attr("data-icon");
                company.name = $(this).attr("data-companyName");
                company.price = ($(this).attr("data-price") / 100 ).toFixed(2);
                console.log(company);
                SS.setObj("company", company);
                return;
            }
        })

        var reqData = {
            commercialInsurance:  SS.get("commercialInsurance"),
            compulsoryInsurance: SS.get("compulsoryInsurance"),
            insuranceCompanyId: 0,
            tax:  SS.get("tax")
        }

        $("#carNo").text(SS.get("lpn"));
        var sum = reqData.commercialInsurance/100 + reqData.compulsoryInsurance/100 + reqData.tax/100;
        sum = Number(sum).toFixed(2);
        console.log(sum);
        $("#orgi_price").text(sum + "元");
        $("#total_fee").text("总保费:￥"+ sum )
        $.ajax({
            url: Constants.hostIp + "weixin/trade/findBid",
            data: reqData,
            type: "get",
            success: function (data, status, xhr) {
                console.log(data);
                if (data.status == 0) {
                    $("#4s_price").text( (data.bid.priceFor4s / 100 ).toFixed(2) + "元");
                    $("#elec_price").text( ( data.bid.priceForEcommerce / 100 ).toFixed(2) + "元");
                    preprice.renderData(  data.bid.insuranceCompanyBidList );
                } else {
                    $.alert(data.msg);
                }
            }
        });

    },

    renderData: function (datalist) {
        var html = "";
        if (datalist.length <= 4) {
            for (var i = 0; i < datalist.length; i++) {
                datalist[i].index = i;
                html += preprice.processString(datalist[i]);
            }
            $("#defineList").html(html);
            $("#more-btn").hide();

        } else {
            for (var i = 0; i < 4; i++) {
                datalist[i].index = i;
                html += preprice.processString(datalist[i]);
            }
            $("#defineList").html(html);
            $("#more-btn").show();
            html = "";
            for (var i = 4; i < datalist.length; i++) {
                datalist[i].index = i;
                html += preprice.processString(datalist[i]);
            }
            $("#moreList").html(html);
        }

    },

    processString: function (obj) {
        var html = "";
        html += "<li class=\"flex-m\">";
        html += "<div class=\"lst-logo\"><img src=\""+ obj.icon +"\" ><p>"+obj.companyName+"</p></div>";
        html += "<div class=\"flex-1 price-info\">";

        if (obj.index == 0)
            html += "   <div class=\"info-s\">平台推荐.车帮一口价</div>";
        else if (obj.index == 1)
            html += "   <div class=\"info-s\">性价比最高.车帮一口价</div>";
        else if (obj.index == 2)
            html += "   <div class=\"info-s\">价格最低.车帮一口价</div>";
        else if (obj.index == 3)
            html += "   <div class=\"info-s\">土豪推荐.车帮一口价</div>";
        else
            html += "   <div class=\"info-s\">车帮一口价</div>";

        html += "   <div class=\"price\">" + (obj.fixedPrice/100).toFixed(2) + "<span>元</span></div>";
        html += "</div>";
        html += "<div class=\"lst-check\">";
        html += "   <input type=\"radio\"  data-companyName='"+ obj.companyName+"' data-icon='" + obj.icon + "'  data-companyId='"+obj.companyId+"' data-price='" + Number(obj.fixedPrice).toFixed(2) + "' id=\"lst-radio" + obj.index + "\" name=\"opinions\" class=\"lst-radio\">";
        html += "   <label for=\"lst-radio" + obj.index + "\"></label>";
        html += "</div>";
        html += "</li>";
        html += "<div class=\"company-info\" style=\"display:none\">" + obj.intro + "</div>";
        return html;
    }

}
preprice.init();
